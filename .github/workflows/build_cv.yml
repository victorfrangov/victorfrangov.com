name: Build and Deploy CVs

on:
  push:
    branches:
      - main  # Set this to 'master' if your default branch is master

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install RenderCV
        run: |
          # The --upgrade flag ensures we get v2.5+, which supports --pdf-path
          pip install --upgrade "rendercv[full]"

      - name: Build PDFs (RenderCV)
        run: |
          # We use --pdf-path to save the PDF directly to the right name/location
          # This prevents the French CV from overwriting the English one
          rendercv render data/cv_en.yaml --pdf-path public/cv_en.pdf
          rendercv render data/cv_fr.yaml --pdf-path public/cv_fr.pdf
          
          # Clean up any extra folders RenderCV might leave behind (optional)
          rm -rf rendercv_output

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          cname: cv.victorfrangov.com